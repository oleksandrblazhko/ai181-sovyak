## Короткий звiт

Збережений міжсайтовий сценарій (XSS) є найнебезпечнішим типом міжсайтового сценарію. Веб-програми, які дозволяють користувачам зберігати дані, потенційно піддаються такому типу атак. У цьому розділі наведено приклади впровадження збережених міжсайтових сценаріїв і відповідні сценарії використання.

Збережений XSS виникає, коли веб-програма збирає вхідні дані від користувача, які можуть бути зловмисними, а потім зберігає ці введені дані в сховищі даних для подальшого використання. Введені дані не відфільтровано належним чином. Як наслідок, шкідливі дані виглядатимуть як частина веб-сайту та запускатимуться в браузері користувача з правами веб-програми. Оскільки ця вразливість зазвичай стосується принаймні двох запитів до програми, її також можна назвати XSS другого порядку.

Цю вразливість можна використовувати для здійснення ряду атак на основі браузера, зокрема:

- Викрадення браузера іншого користувача
- Збирання конфіденційної інформації, яку переглядають користувачі програми
- Псевдо псування програми
- Сканування портів внутрішніх хостів («внутрішніх» по відношенню до користувачів веб-додатку)
- Спрямована доставка експлойтів на основі браузера
- Інші шкідливі дії

Для використання збереженого XSS не потрібне шкідливе посилання. Успішне використання відбувається, коли користувач відвідує сторінку зі збереженим XSS. Наступні етапи стосуються типового сценарію атаки XSS, що зберігається:

- Зловмисник зберігає шкідливий код на вразливій сторінці
- Користувач проходить автентифікацію в додатку
- Користувач відвідує вразливу сторінку
- Шкідливий код виконується браузером користувача

Цей тип атаки також можна використати за допомогою фреймворків використання браузера, таких як BeEF і XSS Proxy. Ці фреймворки дозволяють розробляти складні JavaScript-експлойти.

Збережений XSS є особливо небезпечним у прикладних областях, до яких мають доступ користувачі з високими правами. Коли адміністратор відвідує вразливу сторінку, його браузер автоматично виконує атаку. Це може призвести до розкриття конфіденційної інформації, наприклад маркерів авторизації сеансу.

## Цілі тесту

- Визначте збережений вхід, який відображається на стороні клієнта.
- Оцініть вхідні дані, які вони приймають, і кодування, яке застосовується після повернення (якщо таке є).

## Як тестувати

### Тестування чорної скриньки
Процес виявлення збережених уразливостей XSS подібний до процесу, описаного під час тестування відображеного XSS.

### Форми введення
Першим кроком є визначення всіх точок, де дані користувача зберігаються у серверній частині, а потім відображаються програмою. Типові приклади збереженого введення користувача можна знайти в:

Сторінка користувача/профілів: програма дозволяє користувачеві редагувати/змінювати деталі профілю, такі як ім’я, прізвище, псевдонім, аватар, зображення, адреса тощо.
Кошик для покупок: програма дозволяє користувачеві зберігати товари в кошику для покупок, які потім можна переглянути пізніше
Файловий менеджер: програма, яка дозволяє завантажувати файли
Параметри програми/параметри: програма, яка дозволяє користувачеві встановлювати параметри
Форум/Дошка оголошень: програма, яка дозволяє обмінюватися повідомленнями між користувачами
Блог: якщо програма блогу дозволяє користувачам надсилати коментарі
Журнал: якщо програма зберігає деякі дані користувачів у журналах.

### Проаналізуйте код HTML
Вхідні дані, які зберігає програма, зазвичай використовуються в тегах HTML, але їх також можна знайти як частину вмісту JavaScript. На цьому етапі дуже важливо зрозуміти, чи зберігаються введені дані та як вони розташовані в контексті сторінки. На відміну від відображеного XSS, тестер пера також повинен досліджувати будь-які позасмугові канали, через які програма отримує та зберігає дані користувачів.
Примітка. Усі області програми, до яких мають доступ адміністратори, слід перевірити на наявність будь-яких даних, наданих користувачами.

### Тестування для збережених XSS
Це включає в себе тестування перевірки вхідних даних і елементів керування фільтрацією програми. Основні приклади ін'єкцій у цьому випадку:

aaa@aa.com&quot;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;
aaa@aa.com%22%3E%3Cscript%3Ealert(document.cookie)%3C%2Fscript%3E
Переконайтеся, що введені дані надіслано через додаток. Зазвичай це передбачає вимкнення JavaScript, якщо реалізовано засоби контролю безпеки на стороні клієнта, або зміну запиту HTTP за допомогою веб-проксі. Також важливо перевірити ту саму ін’єкцію як із запитами HTTP GET, так і POST. Вищевказане впровадження призводить до появи спливаючого вікна зі значеннями файлів cookie.

### Використовуйте збережений XSS за допомогою BeEF
Збережені XSS можуть бути використані розширеними фреймворками використання JavaScript, такими як BeEF і XSS Proxy.

Типовий сценарій експлуатації BeEF передбачає:

Впровадження перехоплювача JavaScript, який зв’язується з фреймворком використання браузера зловмисника (BeEF)
Очікування, поки користувач програми перегляне вразливу сторінку, де відображаються збережені введення
Керуйте браузером користувача програми через консоль BeEF
Перехоплення JavaScript можна впровадити, використовуючи вразливість XSS у веб-додатку.
